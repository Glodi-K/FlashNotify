<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation API - FlashNotify</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css" rel="stylesheet">
    <style>
        .endpoint { border-left: 4px solid #007bff; padding-left: 15px; margin: 20px 0; }
        .method-get { border-left-color: #28a745; }
        .method-post { border-left-color: #ffc107; }
        .method-delete { border-left-color: #dc3545; }
        .badge-method { font-size: 0.8em; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">üì± FlashNotify</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('index') }}">Accueil</a>
                <a class="nav-link" href="{{ url_for('dashboard') }}">Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h5>üìã Sommaire</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li><a href="#auth">üîê Authentification</a></li>
                            <li><a href="#notifications">üìß Notifications</a></li>
                            <li><a href="#stats">üìä Statistiques</a></li>
                            <li><a href="#queue">üîÑ File d'attente</a></li>
                            <li><a href="#performance">‚ö° Performance</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <h1>üìö Documentation API FlashNotify</h1>
                <p class="lead">API REST pour le syst√®me de notification acad√©mique</p>
                
                <div class="alert alert-info">
                    <strong>Base URL:</strong> <code>https://votre-app.onrender.com</code><br>
                    <strong>Authentification:</strong> Session Cookie requis pour toutes les routes API
                </div>

                <!-- Authentification -->
                <section id="auth" class="mb-5">
                    <h2>üîê Authentification</h2>
                    <p>Toutes les routes API n√©cessitent une authentification via session cookie.</p>
                    
                    <div class="endpoint">
                        <h4><span class="badge bg-warning badge-method">POST</span> /login</h4>
                        <p>Connexion utilisateur</p>
                        <h6>Param√®tres:</h6>
                        <pre><code class="language-json">{
  "email": "admin@flashnotify.local",
  "password": "admin123"
}</code></pre>
                        <h6>R√©ponse:</h6>
                        <p>Redirection + Cookie de session</p>
                    </div>
                </section>

                <!-- Notifications -->
                <section id="notifications" class="mb-5">
                    <h2>üìß Notifications</h2>
                    
                    <div class="endpoint method-get">
                        <h4><span class="badge bg-success badge-method">GET</span> /api/notifications</h4>
                        <p>R√©cup√®re la liste des notifications (50 derni√®res)</p>
                        <h6>R√©ponse:</h6>
                        <pre><code class="language-json">[
  {
    "id": 1,
    "title": "Cours annul√©",
    "body": "Le cours de POO est annul√©",
    "emergency_type": "acad√©mique",
    "priority": "MEDIUM",
    "user_id": 2,
    "created_at": "2024-01-15T10:30:00Z",
    "sent_at": "2024-01-15T10:30:05Z"
  }
]</code></pre>
                    </div>

                    <div class="endpoint method-post">
                        <h4><span class="badge bg-warning badge-method">POST</span> /send-notification</h4>
                        <p>Envoie une nouvelle notification</p>
                        <h6>Param√®tres:</h6>
                        <pre><code class="language-json">{
  "user_id": "2",
  "title": "Nouveau cours",
  "body": "Un nouveau cours a √©t√© ajout√©",
  "emergency_type": "acad√©mique"
}</code></pre>
                    </div>
                </section>

                <!-- Statistiques -->
                <section id="stats" class="mb-5">
                    <h2>üìä Statistiques</h2>
                    
                    <div class="endpoint method-get">
                        <h4><span class="badge bg-success badge-method">GET</span> /api/stats</h4>
                        <p>R√©cup√®re les statistiques globales</p>
                        <h6>R√©ponse:</h6>
                        <pre><code class="language-json">{
  "total_notifications": 156,
  "total_users": 25,
  "by_type": {
    "acad√©mique": 120,
    "urgence": 15,
    "maintenance": 21
  },
  "by_priority": {
    "LOW": 80,
    "MEDIUM": 60,
    "HIGH": 16
  },
  "recent_notifications": [...]
}</code></pre>
                    </div>
                </section>

                <!-- File d'attente -->
                <section id="queue" class="mb-5">
                    <h2>üîÑ File d'attente</h2>
                    
                    <div class="endpoint method-get">
                        <h4><span class="badge bg-success badge-method">GET</span> /api/queue/status</h4>
                        <p>Statut de la file d'attente des notifications</p>
                        <h6>R√©ponse:</h6>
                        <pre><code class="language-json">{
  "queue_size": 3,
  "total_tasks": 45,
  "running_tasks": 1,
  "pending_tasks": 2,
  "tasks": [
    {
      "id": "task_123",
      "status": "RUNNING",
      "created_at": "2024-01-15T10:30:00Z",
      "started_at": "2024-01-15T10:30:01Z",
      "retry_count": 0,
      "priority": 1
    }
  ]
}</code></pre>
                    </div>

                    <div class="endpoint method-post">
                        <h4><span class="badge bg-warning badge-method">POST</span> /api/queue/clear</h4>
                        <p>Efface et red√©marre la file d'attente (Admin uniquement)</p>
                    </div>
                </section>

                <!-- Performance -->
                <section id="performance" class="mb-5">
                    <h2>‚ö° Performance</h2>
                    
                    <div class="endpoint method-get">
                        <h4><span class="badge bg-success badge-method">GET</span> /api/performance</h4>
                        <p>M√©triques de performance (100 derni√®res)</p>
                        <h6>R√©ponse:</h6>
                        <pre><code class="language-json">[
  {
    "id": 1,
    "metric_name": "notification_send_time",
    "value": 0.245,
    "timestamp": "2024-01-15T10:30:00Z",
    "metadata": {
      "user_id": 2,
      "notification_type": "email"
    }
  }
]</code></pre>
                    </div>
                </section>

                <!-- Codes d'erreur -->
                <section id="errors" class="mb-5">
                    <h2>‚ùå Codes d'erreur</h2>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>200</td><td>Succ√®s</td></tr>
                                <tr><td>302</td><td>Redirection (apr√®s login)</td></tr>
                                <tr><td>400</td><td>Requ√™te invalide</td></tr>
                                <tr><td>401</td><td>Non authentifi√©</td></tr>
                                <tr><td>403</td><td>Acc√®s refus√©</td></tr>
                                <tr><td>404</td><td>Ressource non trouv√©e</td></tr>
                                <tr><td>500</td><td>Erreur serveur</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Exemples -->
                <section id="examples" class="mb-5">
                    <h2>üí° Exemples d'utilisation</h2>
                    
                    <h4>JavaScript (Fetch API)</h4>
                    <pre><code class="language-javascript">// R√©cup√©rer les notifications
fetch('/api/notifications', {
  credentials: 'include' // Important pour les cookies
})
.then(response => response.json())
.then(data => console.log(data));

// R√©cup√©rer les statistiques
fetch('/api/stats', {
  credentials: 'include'
})
.then(response => response.json())
.then(stats => {
  console.log(`Total notifications: ${stats.total_notifications}`);
});</code></pre>

                    <h4>Python (Requests)</h4>
                    <pre><code class="language-python">import requests

# Session pour maintenir les cookies
session = requests.Session()

# Login
login_data = {
    'email': 'admin@flashnotify.local',
    'password': 'admin123'
}
session.post('https://votre-app.onrender.com/login', data=login_data)

# R√©cup√©rer les notifications
response = session.get('https://votre-app.onrender.com/api/notifications')
notifications = response.json()
print(f"Nombre de notifications: {len(notifications)}")</code></pre>
                </section>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>